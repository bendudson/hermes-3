# Transport simulation with deuterium, tritium and helium

nout = 100
timestep = 1000

MZ = 1

[mesh]

file = "tokamak.nc"

extrapolate_y=false  # Can result in negative Jacobians in guard cells

[mesh:paralleltransform]
type = shifted

[solver]
#type = beuler
#pc_type = hypre
type = pvode
mxstep=10000

atol = 1e-7
rtol = 1e-5

#diagnose = true
predictor = false

[hermes]
components = (d+, d, t+, t, he+, he, e,
              sheath_boundary, collisions, thermal_force, recycling,
              reactions, electron_force_balance,
              ion_viscosity)

Nnorm = 2e18  # Reference density [m^-3]
Bnorm = 1   # Reference magnetic field [T]
Tnorm = 200   # Reference temperature [eV]

loadmetric = false  # Recalculate metric tensor? (false -> use grid values)
normalise_metric = true

################################################################
# Deuterium ions

[d+]
type = evolve_density, evolve_momentum, evolve_pressure, anomalous_diffusion

AA = 2
charge = 1
anomalous_D = 0.5    # Density diffusion [m^2/s]
anomalous_chi = 1

thermal_conduction = true

recycle_as = d
recycle_multiplier = 0.99  # Recycling fraction

[Nd+]

function = 1 - 0.9*x

bndry_core = dirichlet(1.0)  # Core boundary high density
bndry_all = neumann

[Pd+]
function = (1 - 0.9*x)^2
bndry_core = dirichlet(1.0)  # Core boundary high density
bndry_all = neumann

################################################################
# Deuterium neutrals

[d]
type = neutral_mixed

AA = 2

################################################################
# Tritium ions

[t+]
type = evolve_density, evolve_momentum, evolve_pressure, anomalous_diffusion

AA = 3
charge = 1
anomalous_D = 0.5    # Density diffusion [m^2/s]
anomalous_chi = 1.0

thermal_conduction = true

recycle_as = t
recycle_multiplier = 0.99  # Recycling fraction

[Nt+]

function = 1 - 0.9*x

bndry_core = dirichlet(1.0)  # Core boundary high density
bndry_all = neumann

[Pt+]
function = (1 - 0.9*x)^2
bndry_core = dirichlet(1.0)  # Core boundary high density
bndry_all = neumann

################################################################
# Tritium neutrals

[t]
type = neutral_mixed

AA = 3

################################################################
# Helium ions

[he+]
type = evolve_density, evolve_momentum, evolve_pressure, anomalous_diffusion

AA = 4
charge = 1
anomalous_D = 0.5    # Density diffusion [m^2/s]
anomalous_chi = 1.0

thermal_conduction = true

recycle_as = he
recycle_multiplier = 0.99  # Recycling fraction

diagnose = true

[Nhe+]

function = 0.01 * (1 - 0.9*x)

bndry_core = dirichlet(0.01)  # Core boundary high density
bndry_all = neumann

[Phe+]
function = 0.01 * (1 - 0.9*x)^2
bndry_core = dirichlet(0.01)  # Core boundary high density
bndry_all = neumann

################################################################
# Helium neutrals

[he]
type = neutral_mixed

AA = 4

################################################################
# Electrons

[e]
# Set electron density from quasineutrality,
# and parallel flow from ion flow, assuming no currents
type = quasineutral, evolve_pressure, zero_current, anomalous_diffusion

AA = 1/1836
charge = -1

anomalous_D = `d+`:anomalous_D  # Note: needed for thermal transport
anomalous_chi = 1
thermal_conduction = true

[Pe]
function = 2.01 * (1 - 0.9*x)^2
bndry_core = dirichlet(2.01)  # Core boundary high density
bndry_all = neumann

################################################################

[recycling]

species = d+, t+, he+

[reactions]
type = (
        d + e -> d+ + 2e,   # Deuterium ionisation
        d+ + e -> d,        # Deuterium recombination
        d + d+ -> d+ + d,   # Deuterium charge exchange
        t + e -> t+ + 2e,   # Tritium ionisation
        t+ + e -> t,        # Tritium recombination
        t + t+ -> t+ + t,   # Tritium charge exchange
        d + t+ -> d+ + t,   # D-T charge exchange
        t + d+ -> t+ + d,   # T-D charge exchange
        he + e -> he+ + 2e, # Helium ionisation
        he+ + e -> he,      # Helium+ recombination
       )

